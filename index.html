<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Questionario</title>
    <link rel="stylesheet" href="index.css">
    <script>
        // Funzione per ottenere il valore di un cookie
        function getCookie(name) {
            const value = `; ${document.cookie}`;
            const parts = value.split(`; ${name}=`);
            if (parts.length === 2) return parts.pop().split(';').shift();
        }

        // Funzione per impostare un cookie
        function setCookie(name, value, days) {
            const date = new Date();
            date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
            const expires = `expires=${date.toUTCString()}`;
            document.cookie = `${name}=${value};${expires};path=/`;
        }

        // Funzione per generare un ID utente univoco
        function generateUserId() {
            const userId = `user-${Math.random().toString(36).substr(2, 9)}`;
            setCookie('userId', userId, 365);
            return userId;
        }

        // Funzione per controllare se l'utente ha già risposto
        async function checkUserSubmission() {
            const userId = getCookie('userId') || generateUserId();
            const response = await fetch(`https://api-7524dbiyoq-uc.a.run.app/user/${userId}`);
            const data = await response.json();
            if (data.hasSubmitted) {
                window.location.href = 'already-answered.html';
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            checkUserSubmission();

            // Aggiungi un listener per l'evento popstate
            window.onpopstate = function () {
                if (location.pathname.endsWith('index.html')) {
                    checkUserSubmission();
                }
            };
        });
    </script>
</head>
<body>
    <div class="container">
        <form id="quizForm">
            <h1>Qual è la tua risposta preferita?</h1>
            <label><input type="radio" name="answer" value="A"> Risposta A</label><br>
            <label><input type="radio" name="answer" value="B"> Risposta B</label><br>
            <label><input type="radio" name="answer" value="C"> Risposta C</label><br>
            <label><input type="radio" name="answer" value="D"> Risposta D</label><br>
            <button type="submit">Invia</button>
        </form>
    </div>
    <script src="script.js"></script>
</body>
</html>
